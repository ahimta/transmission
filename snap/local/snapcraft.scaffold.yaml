title: @@TITLE@@
name: @@NAME@@ # you probably want to 'snapcraft register <name>'
base: core18 # the base snap is the execution environment for this snap
summary: A fast, easy, and free BitTorrent client # 79 char summary
description: |
  Transmission is an open source, volunteer-based project. Unlike some
  BitTorrent clients, Transmission doesn't play games with its users to make
  money.
confinement: devmode
grade: @@GRADE@@ # must be 'stable' to release into candidate/stable channels
icon: gtk/icons/transmission.svg
version: @@VERSION@@ # just for humans, typically '1.2+git' or '1.3.2'

architectures:
- build-on: [amd64]
  run-on: [amd64]

apps:
  @@NAME@@:
    adapter: full
    command: usr/bin/transmission-gtk
    command-chain: [snap/command-chain/desktop-launch]
    desktop: usr/share/applications/transmission-gtk.desktop
    extensions: [gnome-3-28]
    # plugs:
    # - alsa
    # - desktop
    # - home
    # - joystick
    # - opengl
    # - unity7

parts:
  transmission-gtk:
    after: [gnome-extension]
    plugin: nil # See 'snapcraft plugins'
    source: .
    build-packages:
    - autoconf
    - automake
    - build-essential
    - cmake
    - git
    - intltool
    - libappindicator3-dev
    - libb64-dev
    - libcurl4-openssl-dev
    - libevent-dev
    - libglib2.0-dev
    - libgtk-3-dev
    - libminiupnpc-dev
    - libnatpmp-dev
    - libssl-dev
    - libsystemd-dev
    - libtool
    - pkg-config
    override-build: |
      INSTALLATION_PREFIX=$SNAPCRAFT_PART_INSTALL/usr

      git submodule update --init

      rm --recursive --force build
      mkdir build

      cd build
      cmake .. -DCMAKE_INSTALL_PREFIX=$INSTALLATION_PREFIX
      make
      make install

      sed \
        --in-place \
        "s#Exec=.*#Exec=@@NAME@@#" \
        $INSTALLATION_PREFIX/share/applications/transmission-gtk.desktop

        sed \
          --in-place \
          "s#Name=.*#Name=@@TITLE@@#" \
          $INSTALLATION_PREFIX/share/applications/transmission-gtk.desktop

        sed \
          --in-place \
          "s#Icon=.*#Icon=/usr/share/icons/hicolor/scalable/apps/transmission.svg#" \
          $INSTALLATION_PREFIX/share/applications/transmission-gtk.desktop

      snapcraftctl build
    stage-packages:
    - libappindicator3-1
    - libb64-0d
    - libcurl4
    - libevent-2.1-6
    - libminiupnpc10
    - libnatpmp1
